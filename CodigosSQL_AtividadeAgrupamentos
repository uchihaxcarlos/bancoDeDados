Atividades de Agrupamento, Sub consulta e GitHub.

Exercícios de Agrupamento:

1. Agrupe os dependentes por tipo de relação, mostrando somente o atributo
relação.
SELECT RELACAO FROM DEPENDENTE
group by RELACAO

2. Agrupe os dependentes por sexo mostrando somente o atributo sexo.
SELECT SEXO FROM DEPENDENTE
group by SEXO

3. Mostre a quantidade de dependentes por sexo
SELECT SEXO,COUNT(*)
FROM DEPENDENTE
group by SEXO

4. Mostre o valor do maior salário dos empregados
select avg(salario) as med_salario
from empregado

5. Mostre o valor do menor salário dos empregados
SELECT MIN(salario) AS salario
FROM empregado

6. Mostre a soma total de todos os salários dos empregados
SELECT SUM(salario) AS salario
FROM empregado

7. Mostre a soma total dos salários dos empregados por departamento mostrando o código do departamento e os valores para cada um.
SELECT DEPTO,SUM(SALARIO) FROM EMPREGADO
GROUP BY DEPTO

8. Mostre a média dos salários, a soma dos salários, o maior salário, o menor salário, e o desvio padrão dos salários.
SELECT depto,AVG(salario),SUM(salario),MAX(salario),MIN(salario),STDDEV(salario) FROM Empregado
GROUP BY depto


Exercícios de Agrupamento com Junção

1. Mostre o nome do empregado e a quantidade de dependentes que cada um possui.
SELECT nome, COUNT(dependente.nome_dependente)
FROM empregado
LEFT JOIN dependente
ON nome = dependente.nome_dependente
GROUP BY nome

2. Mostre o nome do empregado a quantidade de projetos em que cada empregado está relacionado.
SELECT NOME,COUNT(EMPREGADO_PROJETO.NUMERO_PROJETO) FROM EMPREGADO
INNER JOIN EMPREGADO_PROJETO ON (EMPREGADO_PROJETO.RG_EMPREGADO = EMPREGADO.RG)
GROUP BY NOME,RG_EMPREGADO

3. Para cada empregado, mostre seu nome e a soma total da quantidade de horas alocadas a projetos na qual é participante. o Resultado deve ser apresentado em ordem decrescente.
SELECT NOME,SUM(EMPREGADO_PROJETO.HORAS) AS DURACAO FROM EMPREGADO
INNER JOIN EMPREGADO_PROJETO ON (EMPREGADO_PROJETO.RG_EMPREGADO = EMPREGADO.RG)
GROUP BY NOME,RG_EMPREGADO
ORDER BY DURACAO DESC

4. Mostre o número do departamento e a quantidade de empregados alocados a cada departamento (considere somente departamentos que possuem empregados alocados).
SELECT NUMERO AS NUMERO_PROJETO , COUNT(EMPREGADO_PROJETO.RG_EMPREGADO) AS QT_PROJETOS FROM DEPARTAMENTO
INNER JOIN DEPARTAMENTO_PROJETO ON (DEPARTAMENTO_PROJETO.NUMERO_DEPTO = DEPARTAMENTO.NUMERO)
INNER JOIN EMPREGADO_PROJETO ON (EMPREGADO_PROJETO.NUMERO_PROJETO = DEPARTAMENTO_PROJETO.NUMERO_PROJETO)
GROUP BY NUMERO

5. Mostre o nome do departamento e a quantidade de funcionários alocados a cada departamento, somente nos departamento onde a quantidade de funcionários é maior ou igual a 3.
SELECT DEPARTAMENTO.NOME AS Departamento,COUNT(EMPREGADO.RG) AS Qtd_empregados FROM DEPARTAMENTO
INNER JOIN EMPREGADO ON (EMPREGADO.RG_SUPERVISOR = DEPARTAMENTO.RG_GERENTE)
GROUP BY Departamento
HAVING COUNT(EMPREGADO.RG) >= 3

6. Mostre o nome do departamento e a soma total dos salários dos empregados por departamento, somente para departamentos onde a soma é maior que 6000.
SELECT DEPARTAMENTO.NOME AS Departamento,SUM(EMPREGADO.SALARIO) AS SomaSalario FROM DEPARTAMENTO
INNER JOIN EMPREGADO ON (EMPREGADO.RG_SUPERVISOR = DEPARTAMENTO.RG_GERENTE)
GROUP BY Departamento
HAVING SUM(EMPREGADO.SALARIO) > 6000

Exercícios de Subconsulta:

1 - Mostre o nome do empregado,rg, cpf e nome do departamento, para todos os empregados que são gerentes de algum departamento cujo salário é maior que a média
dos salários dos empregados. (obs: renomear adequadamente os atributos nome conforme necessidade)

SELECT empregado.nome, empregado.rg, empregado.cpf, departamento.nome, empregado.salario
FROM empregado AS empregado
JOIN departamento AS departamento
ON empregado.rg = departamento.rg_gerente
WHERE salario > (SELECT AVG(salario) FROM empregado);

2. Mostre o nome do empregado,rg, cpf, salario, nome do departamento, e a média de salário entre todos os empregados, de modo que apareçam no
resultado somente os empregados que são gerentes de algum departamento e cujo salário é maior que a média dos salários dos empregados.
(obs: renomear adequadamente os atributos nome conforme necessidade)

SELECT empregado.nome, empregado.rg, empregado.cpf, departamento.nome, empregado.salario, departamento.numero,
(SELECT AVG(salario) FROM empregado)
FROM empregado AS empregado
JOIN departamento AS departamento
ON empregado.rg = departamento.rg_gerente
WHERE salario > (SELECT AVG(salario) FROM empregado);

3. Utilizando-se de subconsultas, mostre os nomes e rg de todos os empregados que não possuem
registros na tabela historico_salario.

SELECT empregado.nome, empregado.rg FROM empregado
WHERE empregado.rg NOT IN (SELECT rg FROM historico_salario);

4. Mostre todos os atributos relativos aos empregados, retornando apenas os registros cujos salários são menores que o valor médio dos salários
presentes na tabela histórico_salario.

SELECT empregado.* FROM empregado 
WHERE salario < (SELECT AVG(salario) FROM historico_salario)

5. Mostre todos os atributos relativos aos empregados, retornando apenas os registros cujos salários que estão entre: o valor do menor salário + 1000
e a média dos salários + 1000.

SELECT empregado.* FROM empregado 
WHERE salario BETWEEN (SELECT MIN(salario) + 1000 FROM empregado) 
AND (SELECT AVG(salario)+ 1000 FROM empregado)

6. Mostre todos os atributos relativos aos empregados, retornando apenas os registros cujos salários que estão entre a média - desvio (média - desvio padrão)
e a média mais desvio (média + desvio padrão).

SELECT empregado.* FROM empregado 
WHERE salario BETWEEN (SELECT AVG(salario) - stddev(salario) FROM empregado) 
AND (SELECT AVG(salario) + stddev(salario) FROM empregado)

7. Utilizando-se de subconsulta mostre o nome do empregado e o número de projetos que ele participa,
somente para os empregados que são gerentes de departamento.

SELECT empregado.nome, COUNT(empregado.depto) AS qtd_projetos_trabalha,
projeto.nome
FROM empregado_projeto INNER
JOIN projeto 
ON (projeto.numero = empregado_projeto.numero_projeto)
JOIN empregado
ON (empregado.rg=empregado_projeto.rg_empregado)
GROUP BY empregado.nome ,projeto.nome
ORDER BY empregado.nome ASC
